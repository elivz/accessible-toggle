!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.accessibleToggle=e()}(this,function(){"use strict";var t,e,n=(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});e.default=function(t){var e=void 0,n=function(){if(null===e||void 0===e){for(var n=arguments.length,i=Array(n),o=0;o<n;o++)i[o]=arguments[o];e=requestAnimationFrame(function(n,i){return function(){e=null,t.apply(n,i)}}(this,i))}};return n.cancel=function(){return cancelAnimationFrame(e)},n}}(t={exports:{}},t.exports),t.exports),i=(e=n)&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;var o={trapFocus:!0,assignFocus:!0,closeOnEsc:!0,closeOnClickOutside:!1,mediaQuery:!1,onShow:function(){},onHide:function(){},onEnable:function(){},onDisable:function(){}},s=['a[href]:not([tabindex^="-"]):not([inert])','area[href]:not([tabindex^="-"]):not([inert])',"input:not([disabled]):not([inert])","select:not([disabled]):not([inert])","textarea:not([disabled]):not([inert])","button:not([disabled]):not([inert])",'iframe:not([tabindex^="-"]):not([inert])','[contenteditable]:not([tabindex^="-"]):not([inert])','[tabindex]:not([tabindex^="-"]):not([inert])'],r=9,a=27;function u(t,e){var n=(e||document).querySelectorAll(t);return Array.prototype.slice.call(n)}return function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e&&e instanceof HTMLElement?(this.content=e,this.id=e.id,this.buttons=u("[data-toggle='"+this.id+"']"),this.focusableChildren=this.getFocusableChildElements(),this.options=Object.assign({},o,n),this.throttledMediaQueryTest=i(this.testMediaQuery.bind(this)),0!==this.buttons.length?this.setup():console.warn("Toggle: there are no buttons that control the toggleable element.")):console.warn("Toggle: first parameter must by an HTML element.")}return t.prototype.setup=function(){!1===this.options.mediaQuery?this.enable():(this.testMediaQuery(),window.addEventListener("resize",this.throttledMediaQueryTest))},t.prototype.destroy=function(){window.removeEventListener("resize",this.throttledMediaQueryTest),this.disable()},t.prototype.enable=function(){var t=this;if(!this.active){this.boundClickHandler=this.clickHandler.bind(this),this.boundKeypressHandler=this.keypressHandler.bind(this),document.addEventListener("keydown",this.boundKeypressHandler),document.addEventListener("click",this.boundClickHandler),this.content.setAttribute("aria-labelledby",this.id+"-control-0"),this.buttons.forEach(function(e,n){e.setAttribute("aria-controls",t.id),e.setAttribute("id",t.id+"-control-"+n)}),this.content.hasAttribute("data-toggle-open")?this.show():this.hide(),"function"==typeof this.options.onEnable&&this.options.onEnable();var e=new Event("toggle-enable");this.content.dispatchEvent(e),this.active=!0}},t.prototype.disable=function(){if(this.active){document.removeEventListener("click",this.boundClickHandler),document.removeEventListener("keyup",this.boundKeyupHandler),this.buttons.forEach(function(t){t.removeAttribute("aria-label"),t.removeAttribute("aria-expanded"),t.removeAttribute("aria-controls"),t.removeAttribute("id")}),this.content.removeAttribute("aria-hidden"),this.content.removeAttribute("aria-labelledby"),this.focusableChildren.forEach(function(t){t.hasAttribute("data-toggle-tabindex")?(t.setAttribute("tabindex",t.getAttribute("data-toggle-tabindex")),t.removeAttribute("data-toggle-tabindex")):t.removeAttribute("tabindex")}),"function"==typeof this.options.onDisable&&this.options.onDisable();var t=new Event("toggle-disable");this.content.dispatchEvent(t),this.active=!1}},t.prototype.testMediaQuery=function(){this.options.mediaQuery&&window.matchMedia(this.options.mediaQuery).matches?this.enable():this.disable()},t.prototype.isOpen=function(){return"true"!==this.content.getAttribute("aria-hidden")},t.prototype.show=function(){if(this.content.setAttribute("aria-hidden","false"),this.buttons.forEach(function(t){t.setAttribute("aria-expanded","true")}),this.focusableChildren.forEach(function(t){t.hasAttribute("data-toggle-tabindex")?t.setAttribute("tabindex",t.getAttribute("data-toggle-tabindex")):t.removeAttribute("tabindex")}),this.options.assignFocus){var t=this.content.querySelector("[autofocus]")||this.focusableChildren[0];t&&t.focus()}"function"==typeof this.options.onShow&&this.options.onShow();var e=new Event("toggle-show");return this.content.dispatchEvent(e),this},t.prototype.hide=function(){this.content.setAttribute("aria-hidden","true"),this.buttons.forEach(function(t){t.setAttribute("aria-expanded","false")}),this.focusableChildren.forEach(function(t){var e=t.getAttribute("tabindex");e&&t.setAttribute("data-toggle-tabindex",e),t.setAttribute("tabindex","-1")}),"function"==typeof this.options.onShow&&this.options.onHide();var t=new Event("toggle-hide");return this.content.dispatchEvent(t),this},t.prototype.toggle=function(t){return void 0===t&&(t=!this.isOpen()),t?this.show():this.hide(),this},t.prototype.clickHandler=function(t){for(var e=t.target;e&&1===e.nodeType;){if(this.buttons.indexOf(e)>=0)return t.preventDefault(),void this.toggle();e=e.parentNode}this.options.closeOnClickOutside&&this.isOpen()&&this.content!==t.target&&!this.content.contains(t.target)&&(t.preventDefault(),this.hide())},t.prototype.keypressHandler=function(t){this.options.closeOnEsc&&this.isOpen()&&t.which===a&&(t.preventDefault(),this.hide(),this.buttons[0].focus()),this.options.trapFocus&&t.which===r&&this.trapFocus(t)},t.prototype.getFocusableChildElements=function(){return u(s.join(","),this.content).filter(function(t){return Boolean(t.offsetWidth||t.offsetHeight||t.getClientRects().length)})},t.prototype.trapFocus=function(t){if(this.focusableChildren.length>0){var e=this.focusableChildren.indexOf(document.activeElement)||0;t.shiftKey||e!==this.focusableChildren.length-1||(this.focusableChildren[0].focus(),t.preventDefault()),t.shiftKey&&0===e&&(this.focusableChildren[this.focusableChildren.length-1].focus(),t.preventDefault())}},t}()});
